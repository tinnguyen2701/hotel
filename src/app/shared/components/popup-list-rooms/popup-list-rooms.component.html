<dx-load-panel
    *ngIf="isLoading"
    [visible]="true"
    [showPane]="false"
></dx-load-panel>

<ng-container *ngIf="!isLoading">
    <app-popup-container
        [width]="1000"
        [(visible)]="isShowListRoom"
        (onHiding)="onHiding()"
        [title]="handleTitlePopup()"
        [footerTemplate]="popupFooter"
    >
        <dx-validation-group>
            <div class="form-wrapper">
                <dx-load-panel
                    *ngIf="isProcessing"
                    [visible]="true"
                    [showPane]="false"
                    [message]="'Load'"
                >
                </dx-load-panel>

                <ng-container>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="field w-90">
                                <div class="field-label">
                                    Total peoples
                                </div>
                                <div class="field-value">
                                    <dx-number-box
                                        [(value)]="totalPeoples"
                                        [step]="0"
                                    >
                                    </dx-number-box>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="field w-90">
                                <div class="field-label">
                                    Status
                                </div>
                                <div class="field-value">
                                    <dx-select-box
                                        [(value)]="status"
                                        [dataSource]="roomStatusTypes"
                                        valueExpr="value"
                                        displayExpr="name"
                                    >
                                        <dxi-validation-rule
                                            type="required"
                                            [message]="'This field is required'"
                                        >
                                        </dxi-validation-rule>
                                    </dx-select-box>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>

                <ng-container>
                    <dx-data-grid
                        #dxDataGridRoom
                        height="auto"
                        [dataSource]="listRooms"
                        [showRowLines]="true"
                        [showBorders]="true"
                        [showColumnLines]="true"
                        [hoverStateEnabled]="true"
                        [columnAutoWidth]="false"
                        [allowColumnResizing]="true"
                        [allowColumnReordering]="false"
                    >
                        <dxo-editing
                            mode="row"
                            [allowUpdating]="true"
                            [allowDeleting]="true"
                        >
                            <dxo-texts [confirmDeleteMessage]="null">
                            </dxo-texts>
                        </dxo-editing>

                        <dxo-paging [enabled]="false"></dxo-paging>

                        <dxi-column
                            caption="#"
                            alignment="center"
                            [allowEditing]="false"
                            [allowSorting]="false"
                            [width]="60"
                            [fixed]="true"
                            fixedPosition="left"
                            headerCellTemplate="indexHeaderCellTemplate"
                            cellTemplate="indexCellTemplate"
                        >
                            <div
                                *dxTemplate="
                                    let row of 'indexHeaderCellTemplate'
                                "
                            >
                                <span>Index</span>
                            </div>
                            <div *dxTemplate="let cell of 'indexCellTemplate'">
                                <ng-container>
                                    {{ cell.rowIndex + 1 }}
                                </ng-container>
                            </div>
                        </dxi-column>

                        <dxi-column
                            dataField="name"
                            caption="Name"
                            [width]="210"
                            [allowEditing]="false"
                            [width]="100"
                            alignment="right"
                        >
                        </dxi-column>

                        <dxi-column
                            [width]="150"
                            dataField="checkinDate"
                            alignment="center"
                            caption="Checkin date"
                            [minWidth]="130"
                            format="dd/MM/yyyy"
                            dataType="date"
                            [editorOptions]="{
                                pickerType: 'calendar'
                            }"
                        >
                            <dxi-validation-rule
                                type="required"
                                [message]="'This field is required'"
                            >
                            </dxi-validation-rule>
                        </dxi-column>

                        <dxi-column
                            [width]="150"
                            dataField="checkoutDate"
                            alignment="center"
                            [minWidth]="130"
                            format="dd/MM/yyyy"
                            dataType="date"
                            caption="Checkout date"
                            [editorOptions]="{ pickerType: 'calendar' }"
                        >
                            <dxi-validation-rule
                                type="required"
                                [message]="'This field is required'"
                            >
                            </dxi-validation-rule>
                        </dxi-column>

                        <dxi-column
                            dataField="type"
                            caption="Type room"
                            [width]="120"
                        >
                            <dxo-lookup
                                [dataSource]="roomTypes"
                                valueExpr="value"
                                displayExpr="name"
                            >
                            </dxo-lookup>
                            <dxi-validation-rule
                                type="required"
                                [message]="'This field is required'"
                            >
                            </dxi-validation-rule>
                        </dxi-column>

                        <dxi-column
                            dataField="deduct"
                            [minWidth]="130"
                            alignment="right"
                            dataType="number"
                            caption="Deduct"
                        >
                            <dxi-validation-rule
                                type="required"
                                [message]="'This field is required'"
                            >
                            </dxi-validation-rule>
                        </dxi-column>

                        <dxi-column
                            dataField="prepay"
                            [minWidth]="130"
                            alignment="right"
                            dataType="number"
                            caption="Prepay"
                        >
                            <dxi-validation-rule
                                type="required"
                                [message]="'This field is required'"
                            >
                            </dxi-validation-rule>
                        </dxi-column>

                        <dxi-column
                            dataField="peopleNumber"
                            [minWidth]="130"
                            alignment="right"
                            dataType="number"
                            caption="Total peoples"
                        >
                            <dxi-validation-rule
                                type="required"
                                [message]="'This field is required'"
                            >
                            </dxi-validation-rule>
                        </dxi-column>

                        <dxi-column
                            dataField="note"
                            caption="Note"
                            [width]="200"
                        >
                        </dxi-column>

                        <dxi-column
                            caption="Action"
                            type="buttons"
                            alignment="center"
                            [width]="80"
                        >
                            <dxi-button
                                name="save"
                                icon="save"
                                [text]="''"
                                [hint]="'Save'"
                                [onClick]="onSaveSkill"
                            >
                            </dxi-button>
                            <dxi-button
                                name="cancel"
                                icon="revert"
                                [text]="''"
                                [hint]="'Cancel'"
                                [onClick]="onRevertDxGridRow"
                            >
                            </dxi-button>
                            <dxi-button
                                name="edit"
                                icon="fas fa-pencil-alt edit-icon"
                                [text]="''"
                                [hint]="'Edit'"
                                [onClick]="updateLookupData"
                            >
                            </dxi-button>
                            <dxi-button
                                name="delete"
                                [cssClass]="'far fa-trash-alt delete-icon'"
                                [hint]="'Delete'"
                                [text]="''"
                                [onClick]="onDeleteSkill"
                            >
                            </dxi-button>
                        </dxi-column>
                    </dx-data-grid>
                </ng-container>

                <app-tab
                    [tabs]="menuTabs"
                    [displayExpr]="'text'"
                    [valueExpr]="'value'"
                    [selectedTab]="currentTab"
                    [showCloseIcon]="false"
                    (onSelectionChanged)="changeTab($event)">
                </app-tab>

                <ng-container *ngIf="currentTab.value === Customer">
                    <app-customers></app-customers>
                </ng-container>

                <ng-container *ngIf="currentTab.value === Service">
                    <app-services></app-services>
                </ng-container>

                <ng-template #popupFooter>
                    <div class="d-flex">
                        <dx-button
                            type="normal"
                            class="mr-auto"
                            [text]="'Cancel'"
                            (onClick)="onHandleCancel()"
                        >
                        </dx-button>
                        <dx-button
                            class="ml-auto"
                            type="default"
                            [disabled]="!isFormDirty"
                            [text]="'Save'"
                            [useSubmitBehavior]="false"
                            (onClick)="onHandleSaving()"
                        >
                        </dx-button>
                    </div>
                </ng-template>
            </div>
        </dx-validation-group>
    </app-popup-container>
</ng-container>

<app-popover-confirm-box
    #deleteDetailConfirmPopover
    [message]="'Are you want to remove it out of list'"
    (onConfirm)="deleteRoom()"
>
</app-popover-confirm-box>
